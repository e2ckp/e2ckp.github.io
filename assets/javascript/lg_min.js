var currentServerConfig,default_server_config=JSON.parse('{"ServerConfig":{"whois":"disabled","nslookup":"disabled","ping":"disabled","icmp":"disabled","tracert":"disabled","webcontrol":"disabled","tcp":"disabled","IPv6":"disabled","IPv4":"disabled","curl":"disabled"}}');function applyIPVersionRegex(e){switch(e){case"IPv4":$("#hostname").attr("pattern",domainRegex+"|"+ipv4Regex);break;case"IPv6":$("#hostname").attr("pattern",domainRegex+"|"+ipv6Regex);break;case"IPvDefault":$("#hostname").attr("pattern",domainRegex+"|"+ipv4Regex+"|"+ipv6Regex);break;default:console.log("applyIPVersionRegex: Unexpected value")}}function autoSelectOptions(){$(".autoSelected").each(function(){null==$(this).val()?$(this).val($(this).find("option").not("[disabled]").first().val()):"enabled"!=currentServerConfig[$(this).val()]&&($(this).find("option:selected").each(function(){$(this).removeAttr("selected")}),$(this).val($(this).find("option").not("[disabled]").first().val()))}),hasARequirement()}function hasARequirement(){$(".hasARequirement").find("option:selected").each(function(){"yes"==$(this).attr("hasIPVersion")?applyIPVersionRegex($("#IPVersion").show().val()):($("#IPVersion").hide(),applyIPVersionRegex("IPvDefault")),"yes"==$(this).attr("hasreqScheme")?$("#reqScheme").show():$("#reqScheme").hide()})}function isMobile(){return!($(window).width()>"991")}function lgIframeRun(){var e=$("#"+localStorage.SelectedServerID).data("svjson").Url;e&&""!=e?($("#loadingCircle").show(),$("#runButton").prop("disabled",!0),$("#funcCard").show(),$("#funcFrame").attr("src",e+"/looking-glass-controller?"+$("#lg_run_form").serialize())):$("#serverSelectModal").modal("toggle"),setTimeout(()=>{$("#runButton").prop("disabled",!1)},1200)}function svTableFill(e){$("#pageDescr").hide(),$(".svDescr").show(),$(".serverLocation").html($(e).data("svloc"));var t=$(e).data("svjson");["Description","IPV4Address","IPV6Address","ASN"].forEach(function(e){null!=t[e]&&""!=t[e]?$(".server"+e).html(t[e]):$(".server"+e).html("")});var o=[];["ping","tracert","nslookup","curl","whois"].forEach(function(e){"enabled"==currentServerConfig[e]&&o.push(e)});var n="";for(item2 in o)n=""==n?o[item2]:n+","+o[item2];$(".serverServices").html(n)}function listAllToggleToShow(){if("no"==showAllListStat)$("#serverList").find(".collapse").collapse("show"),showAllListStat="yes",$("#showAllLgList").html("Hide all").removeClass("btn-outline-info").addClass("btn-outline-warning");else{var e=localStorage.SelectedServerID;null!=e&&""!=e?($(".collapse").not($("#"+e).parents()).collapse("hide"),$("#"+e).parents().collapse("show")):$("#serverList").find(".collapse").collapse("hide"),showAllListStat="no",$("#showAllLgList").html("Show all").addClass("btn-outline-info").removeClass("btn-outline-success").removeClass("btn-outline-warning")}}function ListServerSelectDelete(){localStorage.removeItem("SelectedServerID"),svButtonLoadSave()}function svApplyConfig(e){for(confIndex in e)"enabled"==e[confIndex]?($("#lgSVconF"+confIndex).prop("disabled",!1),$("#lgSVconF"+confIndex).removeClass("d-none")):($("#lgSVconF"+confIndex).prop("disabled",!0),$("#lgSVconF"+confIndex).addClass("d-none"));"enabled"!=e.IPv4||"enabled"!=e.IPv6?$("#lgSVconFIPvDefault").prop("disabled",!0).addClass("d-none"):$("#lgSVconFIPvDefault").prop("disabled",!1).removeClass("d-none"),svTableFill($("#"+localStorage.SelectedServerID)),autoSelectOptions()}function svButtonLoadSave(e){null!=e&&""!=e?($(".collapse").not($("#"+e).parents()).collapse("hide"),$("#"+e).parents().collapse("show"),$("#"+e).addClass("list-group-item-info"),$("#serverSelectButton").html($("#"+e).data("svname")).addClass("btn-outline-light").removeClass("btn-outline-danger"),svApplyConfig(currentServerConfig=$("#"+e).data("svconf"))):($("#serverList").find(".collapse").collapse("hide").find(".lgserver").removeClass("list-group-item-info"),$("#serverSelectButton").html("Please Select Server").addClass("btn-outline-danger").removeClass("btn-outline-light"))}function svButtonTrigger(){$(function(){$(".server-list-group-item").on("click",function(){$(".collapse").not($(this).parents("")).collapse("hide"),"yes"==showAllListStat&&$("#showAllLgList").html("Show current").addClass("btn-outline-success").removeClass("btn-outline-warning")})}),$(function(){$(".lgserver").on("click",function(){"yes"==showAllListStat&&($(".collapse").not($(this).parents("")).collapse("hide"),$("#showAllLgList").html("Show all").addClass("btn-outline-info").removeClass("btn-outline-success").removeClass("btn-outline-warning"),showAllListStat="no"),$(".lgserver").removeClass("list-group-item-info"),localStorage.setItem("SelectedServerID",$(this).attr("id")),$("#serverSelectButton").html($(this).data("svname")),svApplyConfig(currentServerConfig=$(this).data("svconf")),$("#serverSelectButton").addClass("btn-outline-light").removeClass("btn-outline-danger"),$(this).toggleClass("list-group-item-info").toggleClass("")})})}function svConfigComparisor(e,t){var o={...e},n={...t};for(confIndex in e)"object"==typeof e[confIndex]&&"object"==typeof n[confIndex]?o[confIndex]=svConfigComparisor(e[confIndex],n[confIndex]):t[confIndex]&&(o[confIndex]=n[confIndex]);return o}function arrToDashString(e){var t="";for(item in e)t=""==t?e[item]:t+"-"+e[item];return t}function arrToDotString(e){var t="";for(item in e)t=""==t?e[item]:t+"."+e[item];return t}function lgServerListLoad(e,t,o){if(null!=o&&"object"==typeof o)if(o.length>6)console.log("You are reach maximum depth of server list. Please keep list depth at maximum 5.");else for(index in e){var n=index;if(e[index].ServerConfig)var s=svConfigComparisor(t,e[index].ServerConfig);else s=t;if(void 0===e[index].Name&&""!=e[index].Name)var a=index;else a=e[index].Name;if(void 0===e[index].Description)var l="";else l=e[index].Description;if(e[index].JsonURL)console.log("Currently Nested Json List is not Supported");else if("object"==typeof e[index].Servers){(r=Object.assign([],o)).push(n),$("#"+arrToDashString(o)).append('<button href="#'+arrToDashString(r)+'" class="server-list-group-item list-group-item list-group-item-action btn btn-dark" data-toggle="collapse"><i class="fas fa-list text-dark"></i> '+a+'<small class="text-muted float-right">'+l+'</small></button><div class="list-group collapse" id="'+arrToDashString(r)+'"> '),lgServerListLoad(e[index].Servers,s,r),$("#"+arrToDashString(o)).append("</div>")}else if(e[index].Url){var r;(r=Object.assign([],o)).push(n);var i="",d="";e[index].ASN&&(i=i+'\t&nbsp; <span class="badge badge-light">'+e[index].ASN+"</span> "),"enabled"==s.IPv4||"enabled"==s.IPv6?"enabled"==s.IPv4&&"enabled"==s.IPv6?i+='<font class="server-list-feature-icons text-success" data-toggle="tooltip" data-placement="top" title="IPv4 and IPv6 Connection">DS</font>':"enabled"==s.IPv4?i+='<font class="server-list-feature-icons text-muted" data-toggle="tooltip" data-placement="top" title="IPv4 OnlyConnection">IPv4</font>':i+='<font class="server-list-feature-icons text-warning" data-toggle="tooltip" data-placement="top" title="IPv6 Only Connection">IPv6</font>':d="disabled","enabled"==s.tracert&&(i+='<i class="fas fa-road server-list-feature-icons text-muted" data-toggle="tooltip" data-placement="top" title="TraceRoute"></i>'),$("#"+arrToDashString(o)).append('<button class="server-list-group-item list-group-item list-group-item-action btn btn-light lgserver"'+d+" data-svjson='"+JSON.stringify(e[index])+"' data-svName='"+a+"' data-svloc='"+arrToDotString(r).replace("serverList.","")+"' data-svconf='"+JSON.stringify(s)+"' id=\""+arrToDashString(r)+'"><i class="fas fa-server text-primary"></i>'+a+i+'<small class="text-muted float-right">'+l+"</small></button>")}else console.log("Error: "+arrToDashString(o)+" "+index+" is unknown type of server.")}else console.log("Depth is not array")}function lgServerListLoadAjax(e,t){$.ajax({url:e,dataType:"json",success:function(e){localStorage.setItem("server_js",JSON.stringify(e)),lgServerListLoad(e.Servers,svConfigComparisor(default_server_config.ServerConfig,e.ServerConfig),["serverList"]),svButtonTrigger(),svButtonLoadSave(localStorage.SelectedServerID),$(function(){$('[data-toggle="tooltip"]').tooltip()})},error:function(e){200==e.status?console.log("ERROR: ","Json Parse Error"):console.log("ERROR: ",e)}})}ipv6Regex="^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$",ipv4Regex="^(((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\\.|$)){4})",domainRegex="^(?:[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?\\.)+[a-z0-9][a-z0-9-]{0,61}[a-z]$",portRegex="^((6553[0-5])|(655[0-2][0-9])|(65[0-4][0-9]{2})|(6[0-4][0-9]{3})|([1-5][0-9]{4})|([1-9][0-9]{3})|([1-9][0-9]{2})|([1-9][0-9])|([1-9]))$",$(document).ready(function(){isMobile()&&$("#isMobile").val("1"),$(".hasARequirement").change(function(){hasARequirement()}).change(),$("#IPVersion").change(function(){applyIPVersionRegex($(this).val())}).change(),$("#funcFrame").on("load",function(){$("#loadingCircle").hide()})}),showAllListStat="no","undefined"!=typeof Storage?lgServerListLoadAjax("server.json",0):($("#serverSelectButton").prop("disabled",!0),$("#serverSelectButton").html("Sorry! No Web Storage support."));